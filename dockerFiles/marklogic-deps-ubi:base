###############################################################
#
#   Copyright Â© 2018-2025 Progress Software Corporation and/or its subsidiaries or affiliates. All Rights Reserved.
#
###############################################################

FROM registry.access.redhat.com/ubi8/ubi-minimal:8.10-1761032271
LABEL "com.marklogic.maintainer"="docker@marklogic.com"

# MarkLogic version passed from build to enable conditional deps
ARG ML_VERSION

###############################################################
# install libnsl rpm package
###############################################################

RUN microdnf -y update \
    && rpm -i https://download.rockylinux.org/pub/rocky/8/BaseOS/x86_64/os/Packages/l/libnsl-2.28-251.el8_10.25.x86_64.rpm

###############################################################
# install networking, base deps and tzdata for timezone
###############################################################
# hadolint ignore=DL3006
RUN echo "NETWORKING=yes" > /etc/sysconfig/network \
    && microdnf -y install --setopt install_weak_deps=0 gdb redhat-lsb-core initscripts tzdata glibc libstdc++ hostname \
    && microdnf clean all

###############################################################
# MarkLogic 10 requires 32-bit libstdc++ runtime
###############################################################
RUN if [ -n "$ML_VERSION" ] && [ "${ML_VERSION%%.*}" = "10" ]; then \
        microdnf -y install --setopt install_weak_deps=0 libstdc++.i686 && \
        microdnf clean all; \
    fi


###############################################################
# Enable FIPS Mode
###############################################################
RUN update-crypto-policies --set FIPS